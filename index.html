<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Harvest Firearms Training | NRA Certified Courses</title>
    
    <meta name="description" content="The Harvest Firearms Training provides NRA Certified training courses including Basic Rifle, Muzzleloading, RSO, and CA DOJ FSC in Bakersfield, California. Schedule your firearm safety class today.">
    <meta name="keywords" content="NRA certified instructor, The Harvest, Christian firearm training, gun safety class, Bakersfield California, Basic Rifle, Muzzleloading, Range Safety Officer, RSO, CA DOJ FSC">
    
    <link rel="icon" type="image/png" href="inst-color.jpg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply Inter font and set base styles */
        body {
            font-family: 'Inter', sans-serif;
            /* Using a dark gray background */
            background-color: #1a1a1a; 
        }
        /* Custom styles for professional look */
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }
        /* Marine Corps Theme Colors */
        .marine-navy { color: #003366; }
        .marine-scarlet { color: #800000; } 
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // BRIGHT GREEN ACCENT
                        'primary-dark-text': '#e0e0e0', // Light Gray for main text in the dark theme
                        'accent-red': '#33FF33', 
                        'marine-navy': '#003366', // Deep Navy Blue (Header/Footer)
                        'light-gray-bg': '#333333', // Darker background for light-gray classes (e.g., date buttons)
                        'card-bg': '#2a2a2a', // Background for content cards
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-[#1a1a1a] text-primary-dark-text">

    <header class="bg-marine-navy text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="#home" class="text-xl sm:text-lg font-extrabold tracking-tight whitespace-nowrap overflow-hidden">
                    The Harvest Firearms Training
                </a>

                <div class="relative">
                    <button id="dropdown-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white transition duration-150 ease-in-out">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>

                    <div id="dropdown-menu" class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-card-bg ring-1 ring-white ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="dropdown-button">
                        <div class="py-1" role="none">
                            <a href="#home" class="nav-link block px-4 py-2 text-sm text-primary-dark-text hover:bg-light-gray-bg hover:text-accent-red rounded-md m-1 transition duration-150" role="menuitem">Home</a>
                            <div class="border-t border-gray-600 my-1"></div>
                            <span class="block px-4 pt-2 text-xs font-semibold text-gray-400 uppercase">Course Details</span>
                            <a href="#muzzle-loader" class="nav-link block px-4 py-2 text-sm text-primary-dark-text hover:bg-light-gray-bg hover:text-accent-red rounded-md m-1 transition duration-150" role="menuitem">NRA Muzzle Loader Course</a>
                            <a href="#rso" class="nav-link block px-4 py-2 text-sm text-primary-dark-text hover:bg-light-gray-bg hover:text-accent-red rounded-md m-1 transition duration-150" role="menuitem">NRA Range Safety Officer (RSO) Course</a>
                            <a href="#basic-rifle" class="nav-link block px-4 py-2 text-sm text-primary-dark-text hover:bg-light-gray-bg hover:text-accent-red rounded-md m-1 transition duration-150" role="menuitem">NRA Basic Rifle Course</a>
                            <a href="#fsc" class="nav-link block px-4 py-2 text-sm text-primary-dark-text hover:bg-light-gray-bg hover:text-accent-red rounded-md m-1 transition duration-150" role="menuitem">NRA Gun Safety Seminar/CA DOJ FSC Course</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main id="content" class="min-h-screen pt-8 pb-16 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h1 class="text-2xl font-bold text-center text-gray-400 mt-12">Loading...</h1>
    </main>

    <footer class="bg-marine-navy text-white text-center p-4">
        <p class="text-sm">&copy; 2025 The Harvest Firearms Training Professionals. All Rights Reserved. NRA Certified Instruction. Serving Bakersfield, California.</p>
        <p class="text-xs mt-1">If no courses are currently scheduled, please email <a href="mailto:TheHarvestFirearmsTraining@outlook.com" class="text-accent-red hover:underline font-semibold">TheHarvestFirearmsTraining@outlook.com</a> or call <a href="tel:+19495473698" class="text-accent-red hover:underline font-semibold">(949) 547-3698</a> to schedule a future course date.</p>
    </footer>

    <script>
        // --- DYNAMIC COURSE DATA STORAGE ---
        const COURSE_DATA = {
            'muzzle-loader': {
                title: "NRA CO-OP Basic Muzzleloading Rifle",
                description: "This comprehensive course focuses on the safe and effective operation of pre-1900 style muzzle loading firearms. This training provides the foundational knowledge and skills necessary for safe use, handling, and maintenance of historical black powder arms.",
                price: 125,
                deposit: 50,
                logo: 'inst-color.jpg', // Instructor Logo
                secondaryLogo: '', // No secondary logo
                features: [
                    "Safety and History: In-depth classroom coverage of muzzle loader safety protocols, historical context, handling, loading, storage, and cleaning.",
                    "Blended Learning: A combination of engaging classroom instruction and practical, hands-on live-fire training at the Bakersfield, California range.", 
                    "Professional Supervision: Instruction is provided by NRA Certified Muzzle Loader Instructors. The firing lines are supervised by certified Range Safety Officers (RSO) and Chief Range Safety Officers (CRSOs) to ensure a safe and productive learning environment."
                ],
                dates: [
		{	date: "Monday December 22nd, 2025 (8:00 AM)",
			link: "https://www.nrainstructors.org/CourseDetails.aspx?Courseid=893942" },
                ]
            },
            'rso': {
                title: "NRA Certified Range Safety Officer (RSO) Course",
                description: "The NRA Range Safety Officer (RSO) course is the Gold Standard of training required to organize, conduct, and supervise safe shooting activities and range operations. This certification is essential for anyone responsible for the management and oversight of firing lines.",
                price: 125,
                deposit: 50,
                // PRIMARY RSO LOGO
                logo: 'rso-color.jpg', 
                // SECONDARY CRSO LOGO for side-by-side display
                secondaryLogo: 'crso-color.jpg', 
                features: [
                    "Range Safety Protocol: Learn standard operating procedures for range use, emergency procedures, and how to inspect a range for safety.",
                    "Supervision and Control: Instruction on how to safely brief shooters, manage the firing line, and correct common malfunctions.",
                    "Certified Instruction: This course is taught directly by NRA certified Chief Range Safety Officers (CRSOs), ensuring you receive instruction from the highest level of certified range management professionals." 
                ],
                dates: [
                    
                ]
            },
            'basic-rifle': {
                title: "NRA Certified Basic Rifle Shooting Course",
                description: "The NRA Basic Rifle Course provides a foundational introduction to the safe and responsible use of a rifle. This training is essential for new rifle owners or those looking to establish a strong basis in rifle marksmanship and safety.",
                price: 150,
                deposit: 50,
                logo: 'inst-color.jpg', // Instructor Logo
                secondaryLogo: '', // No secondary logo
                features: [
                    "Comprehensive Safety: In-depth coverage of NRA rules for safe gun handling, operation, storage, and cleaning.",
                    "Rifle Fundamentals: Instruction on rifle parts, ammunition, shooting fundamentals, and basic maintenance.",
                    "Live-Fire Practice: Practical range time where students can apply classroom knowledge under the supervision of NRA Certified Firearms Instructors. The firing lines are supervised by certified NRA Range Safety Officers (RSO) and Chief Range Safety Officers (CRSOs) to ensure the highest safety standards are met. All training takes place in Bakersfield, California." 
                ],
                dates: [
				]
            },
            'fsc': {
                title: "NRA Gun Safety Seminar <br> / <br> CA DOJ Firearm Safety Certificate (FSC)",
                description: "This essential Firearm Safety Course is conducted by a California Department of Justice (CA DOJ) Certified Instructor. Completion of this course, including passing the required test, allows us to issue your official Firearm Safety Certificate (FSC), which is mandatory for purchasing or transferring firearms in California. As an option you may elect to skip the instructor led training and just take the test. Study material will be available for you to review before attempting to take the test. If you elect to skip the instruction and only take the test, the Course Fee is only the $25.00 deposit.",
               
 // UPDATED FSC PRICING HERE 
                price: 100, // Kept for home page link to show max price
                fsc_price: {
                    test_only: 25,
                    course_only: 75,
                    course_and_test: 100
                },
                deposit: 25, 
                // LOGO REMOVED
                logo: '', 
                secondaryLogo: '', // No secondary logo
                features: [
                    "Official Certification: Successful completion allows us to issue your valid CA DOJ Firearm Safety Certificate (FSC).",
                    "FSC Test Administration: The required 30-question, multiple-choice test is administered during the class in Bakersfield, CA.", 
                    "Mandatory for Purchase: Certificate required by California law to purchase or acquire a handgun, rifle, or shotgun.",
                    "Expert Guidance: Instruction covering safe gun handling, storage, California-specific laws and regulations, and detailed walk throughs and demonstrations of required knowledge."
                ],
                dates: [
		{date: "Monday December 1st, 2025 (12:00 PM)",
			link: "https://www.nrainstructors.org/CourseDetails.aspx?Courseid=901794"},]
            }
        };

        // --- Template Functions for Each Page ---

        const courseCard = (routeKey) => {
            const data = COURSE_DATA[routeKey];
            const deposit = data.deposit;
            const dates = data.dates;
            
            let logoImageTag = '';
            
            // Check for RSO/CRSO special case
            if (routeKey === 'rso' && data.logo && data.secondaryLogo) {
                // RSO and CRSO logos side-by-side (using h-48 for bigger size)
                logoImageTag = `
                    <div class="flex justify-center items-center space-x-6 mb-4">
                        <img src="${data.logo}" alt="NRA Range Safety Officer Logo" class="h-48 w-auto border-2 border-accent-red rounded-lg p-1">
                        <img src="${data.secondaryLogo}" alt="NRA Chief Range Safety Officer Logo" class="h-48 w-auto border-2 border-accent-red rounded-lg p-1">
                    </div>
                `;
            } else if (data.logo) {
                // Single logo case (using h-48 for bigger size)
                logoImageTag = `
                    <img src="${data.logo}" alt="${data.title} Instructor Logo" class="h-48 w-auto mx-auto mb-4 border-2 border-accent-red rounded-lg p-1">
                `;
            } // If data.logo is empty (like FSC), logoImageTag is ''
            
            const depositNote = data.price === data.deposit
                ? 'The full course fee is required upfront to secure your position.'
                : 'The remaining balance is due on the first day of the course.';

            // --- Pricing Content Generation (Functional Update Preserved) ---
            let pricingContent;
            if (routeKey === 'fsc' && data.fsc_price) {
                pricingContent = `
                    <h3 class="text-xl font-bold mb-3 text-primary-dark-text">NRA Gun Safety Seminar / CA DOJ FSC Course Pricing Options:</h3>
                    <ul class="space-y-2 mb-6">
                        <li class="text-lg font-semibold flex justify-between items-center bg-light-gray-bg p-3 rounded-lg">
                            <span>CA DOJ FSC Test Only (No Instruction)</span>
                            <span class="text-accent-red font-extrabold">$${data.fsc_price.test_only}.00</span>
                        </li>
                        <li class="text-lg font-semibold flex justify-between items-center bg-light-gray-bg p-3 rounded-lg">
                            <span>Instructor-Led Firearm Safety Course Only (No Test)</span>
                            <span class="text-accent-red font-extrabold">$${data.fsc_price.course_only}.00</span>
                        </li>
                        <li class="text-lg font-semibold flex justify-between items-center bg-light-gray-bg p-3 rounded-lg">
                            <span>Instructor-Led Firearm Safety Course & CA DOJ FSC Test</span>
                            <span class="text-primary-dark-text font-extrabold">$${data.fsc_price.course_and_test}.00</span>
                        </li>
                    </ul>
                    <p class="text-sm text-gray-300">Required Deposit: <span class="font-bold text-accent-red">$${data.deposit}.00 non-refundable</span></p>
                    <p class="text-sm text-gray-400">Note: The final price will be determined based on the option you choose at registration.</p><br>
                `;
            } else {
                // Original pricing logic for all other courses (RSO, Rifle, Muzzle)
                pricingContent = `
                    <div class="mb-6 space-y-2">
                        <p class="text-lg font-semibold">Course Fee: <span class="text-primary-dark-text">$${data.price}.00</span></p>
                        <p class="text-sm text-gray-300">Required Deposit: <span class="font-bold text-accent-red">$${data.deposit}.00 non-refundable</span></p>
                        <p class="text-sm text-gray-400">${depositNote}</p>
                    </div>
                `;
            }
            // --- End Pricing Content Generation ---

            // Logic to dynamically generate date links or the "no dates" message
            const dateContent = dates.length > 0
                ? dates.map(d => `
                    <a href="${d.link}" target="_blank" class="block text-center text-lg font-medium bg-light-gray-bg border-b-2 border-accent-red hover:bg-gray-700 text-primary-dark-text transition duration-200 p-3 rounded-md">
                        ${d.date} (Click to Register)
                    </a>
                `).join('')
                : `<p class="text-center text-xl font-bold text-accent-red py-8">
                    No dates are currently scheduled for this course. Please contact us to schedule a date for instruction! 
<br>
<br>
Phone: <a href="tel:+19495473698" class="text-center text-xl font-bold text-accent-red py-8">(949) 547-3698</a><br> or <br><a href="mailto:TheHarvestFirearmsTraining@outlook.com" class="text-center text-xl font-bold text-accent-red py-8">Email: <u>TheHarvestFirearmsTraining@outlook.com</a></u>

                    </p>`;

            return `
                <div class="max-w-4xl mx-auto">
                    <a href="#home" class="inline-flex items-center text-accent-red hover:text-white transition duration-200 mb-6 font-semibold border border-accent-red hover:bg-accent-red px-4 py-2 rounded-lg text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                        Back to All Courses in Bakersfield, CA
                    </a>
                    
                    <h1 class="text-4xl font-extrabold mb-8 text-center text-primary-dark-text">${data.title}</h1>
                
                    <div class="card bg-card-bg p-6 md:p-8 rounded-lg mb-8 transition duration-300 hover:shadow-xl border-t-4 border-accent-red">
                        <div class="text-center">
                            ${logoImageTag} </div>
                        <h2 class="text-2xl font-bold mb-3 text-accent-red">${data.title} Course Overview - Bakersfield, CA</h2> <p class="text-gray-400 mb-6">${data.description}</p>
                        
                        ${pricingContent}

                        <h3 class="text-xl font-semibold mb-3 border-b border-gray-600 pb-1 text-primary-dark-text">Course Highlights:</h3>
                        <ul class="list-disc list-inside space-y-3 pl-4 text-gray-400">
                            ${data.features.map(f => `<li class="leading-relaxed">${f}</li>`).join('')}
                        </ul>
                    </div>

                    <div id="${routeKey}-dates" class="max-w-xl mx-auto mt-12">
                        <h2 class="text-3xl font-extrabold mb-8 text-center text-primary-dark-text">Schedule and Registration</h2>
                        <p class="text-lg text-center text-gray-400 mb-8">
                            Ready to enroll? Select the date you wish to attend below. Clicking the date link will redirect you to our external registration portal to complete your enrollment.
                        </p>
                        <div class="card bg-card-bg p-6 rounded-lg shadow-lg">
                            <p class="text-center text-sm font-semibold text-accent-red mb-6">
                                Note on Deposits: A non-refundable deposit of $${deposit}.00 is required to secure your position.
                            </p>
                            <div class="space-y-4">
                                ${dateContent}
                            </div>
                        </div>
                    </div>

                    <div class="mt-16 mb-4 text-center">
                        <a href="#home" class="inline-flex items-center text-accent-red hover:text-white hover:bg-accent-red transition duration-300 font-bold px-6 py-3 rounded-full shadow-lg text-lg border-2 border-accent-red">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
                            Back to Main Course List - Bakersfield, CA
                        </a>
                    </div>

                </div>
            `;
        }
        
        // Contact Card Template (unchanged)
        const contactCard = () => `
            <div class="card bg-card-bg p-6 md:p-8 rounded-lg mb-12 transition duration-300 border-t-4 border-marine-navy shadow-xl">
                <h2 class="text-2xl font-bold mb-3 text-primary-dark-text">Private & Custom Training Inquiries in Bakersfield, CA</h2> <p class="text-gray-400 mb-6 leading-relaxed">
                    If you are looking to schedule a private lesson, custom group training, or check availability for a course date not listed, please contact our lead instructor directly:
                </p>
                <div class="space-y-4">
                    <div class="flex items-center text-lg">
                        <svg class="w-6 h-6 mr-3 text-accent-red" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-9 13h9a2 2 0 002-2V7a2 2 0 00-2-2H3a2 2 0 00-2 2v10a2 2 0 002 2h9z"></path></svg>
                        <span class="font-semibold text-primary-dark-text">Email:</span>
                        <a href="mailto:TheHarvestFirearmsTraining@outlook.com" class="ml-2 text-gray-300 hover:text-accent-red transition duration-150">TheHarvestFirearmsTraining@outlook.com</a>
                    </div>
                    <div class="flex items-center text-lg">
                        <svg class="w-6 h-6 mr-3 text-accent-red" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2004/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                        <span class="font-semibold text-primary-dark-text">Phone:</span>
                        <a href="tel:+19495473698" class="ml-2 text-gray-300 hover:text-accent-red transition duration-150">(949) 547-3698</a>
                    </div>
                </div>
            </div>
        `;

        const pages = {
            'home': () => `
                <div class="text-center pt-4 pb-10">
                    <h1 class="text-4xl md:text-5xl font-extrabold mb-4 text-primary-dark-text">
                        The Harvest Firearms Training
                    </h1>
                    <p class="text-xl md:text-2xl font-light text-gray-400 max-w-3xl mx-auto">
                        Your source for NRA Certified Training Courses in Bakersfield, California. Start your training today! 
                    </p>
                </div>
                
                <div class="max-w-3xl mx-auto card bg-card-bg p-8 rounded-xl border-t-4 border-marine-navy shadow-xl mb-12">
                    <div class="flex justify-center items-center space-x-6 mb-6">
                       <img src="inst-color.jpg" alt="NRA Certified Instructor Logo" class="h-48 w-auto border-2 border-accent-red rounded-lg p-1">
                        
                        <img src="crso-color.jpg" alt="NRA Chief Range Safety Officer Logo" class="h-48 w-auto border-2 border-accent-red rounded-lg p-1">
                    </div>

                    <h2 class="text-3xl font-bold text-primary-dark-text text-center mb-6">Welcome to The Harvest Firearms Training in Bakersfield, Ca</h2>
                    
                    <p class="text-lg text-gray-400 mb-6 leading-relaxed">
                        Our team consists of experienced, certified professionals dedicated to teaching safe gun handling for anyone. We provide high-quality NRA-certified instruction focusing on responsibility and skill development for all experience levels, from beginners to advanced range officers.
                    </p>
                    <h3 class="text-xl font-semibold mb-3 text-accent-red">Our Commitment to You</h3>
                    <p class="text-gray-400 leading-relaxed">
                        All courses are taught by professional, experienced NRA Certified Firearms Instructors who are committed to your education and safety. For all live-fire exercises, the firing lines are supervised by certified NRA Range Safety Officers (RSO) and Chief Range Safety Officers (CRSOs) to ensure the highest safety standards are met.
                    </p>
                </div>

                ${contactCard()}
                <div class="grid md:grid-cols-2 gap-6">
                    ${homeCourseLink('Muzzle Loader', 'muzzle-loader', 'Learn the safety, history, and marksmanship of black powder Muzzle Loading Rifles under the guidance of NRA Certified Instructors.')}
                    ${homeCourseLink('RSO', 'rso', 'Become a NRA certified Range Safety Officer.')}
                    ${homeCourseLink('Basic Rifle', 'basic-rifle', 'Foundational course for safe rifle use.')}
                    ${homeCourseLink('NRA Gun Safety / CA DOJ FSC', 'fsc', 'Mandatory certificate for firearm purchase in California.')}
                </div>
            `,
            'muzzle-loader': () => courseCard('muzzle-loader'),
            'rso': () => courseCard('rso'),
            'basic-rifle': () => courseCard('basic-rifle'),
            'fsc': () => courseCard('fsc'),
        };
        
        function homeCourseLink(title, hash, description) {
            return `
                <a href="#${hash}" class="block bg-card-bg p-6 rounded-lg card transition duration-300 hover:bg-gray-700 hover:shadow-xl border-t-4 border-accent-red">
                    <h3 class="text-xl font-bold text-primary-dark-text mb-2">${title} Course</h3>
                    <p class="text-gray-400 text-sm mb-4">${description}</p>
                    <span class="text-accent-red font-semibold text-sm inline-flex items-center">
                        View Details & Dates
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </span>
                </a>
            `;
        }

        // --- Routing and Interaction Logic ---

        const contentDiv = document.getElementById('content');
        const dropdownMenu = document.getElementById('dropdown-menu');
        const dropdownButton = document.getElementById('dropdown-button');
        
        // Select nav links *after* the DOM is loaded
        let navLinks = [];

        // Function to toggle the menu open/closed
        const toggleMenu = (isOpen) => {
            const isCurrentlyOpen = !dropdownMenu.classList.contains('hidden');
            
            if (isOpen === undefined) {
                isOpen = !isCurrentlyOpen;
            }

            if (isOpen) {
                dropdownMenu.classList.remove('hidden');
                // Move focus to the first focusable element inside the menu for accessibility
                if (navLinks.length > 0) {
                    navLinks[0].focus();
                }
            } else {
                dropdownMenu.classList.add('hidden');
                // Return focus to the button that opened the menu
                dropdownButton.focus();
            }
            // Add or remove an attribute to signal menu state (important for accessibility)
            dropdownButton.setAttribute('aria-expanded', isOpen);
        };

        // Function to handle keyboard navigation (Focus Trap)
        const handleFocusTrap = (event) => {
            if (dropdownMenu.classList.contains('hidden')) return;

            const focusableElements = [dropdownButton, ...navLinks];
            const firstFocusable = focusableElements[0];
            const lastFocusable = focusableElements[focusableElements.length - 1];

            // If the tab key is pressed
            if (event.key === 'Tab') {
                if (event.shiftKey) { // Shift + Tab
                    if (document.activeElement === firstFocusable) {
                        lastFocusable.focus();
                        event.preventDefault();
                    }
                } else { // Tab
                    if (document.activeElement === lastFocusable) {
                        firstFocusable.focus();
                        event.preventDefault();
                    }
                }
            }
            // If the escape key is pressed
            if (event.key === 'Escape') {
                toggleMenu(false);
            }
        };

        // Function to render the current page
        const renderPage = () => {
            let hash = window.location.hash.substring(1) || 'home';
            
            if (!pages[hash]) {
                hash = 'home';
            }

            // Render the page content
            contentDiv.innerHTML = pages[hash]();

            // Always close the dropdown menu when a page renders
            toggleMenu(false);

            // Update the document title for better user experience and SEO
            const pageTitle = contentDiv.querySelector('h1')?.textContent || 'Home';
            document.title = `The Harvest Firearms Training | ${pageTitle.split(' | ')[0]}`;

            // Scroll to the top of the page on content load
            window.scrollTo(0, 0); 
        };

        // --- Event Listeners and Initialization ---

        // Event listener for hash changes (back/forward navigation, internal links)
        window.addEventListener('hashchange', renderPage);

        // Event listener for the dropdown button
        dropdownButton.addEventListener('click', () => {
            toggleMenu();
        });

        // Event listener for keyboard navigation
        document.addEventListener('keydown', handleFocusTrap);

        // Event listener for clicking anywhere outside the dropdown to close it
        document.addEventListener('click', (event) => {
            const isClickInsideButton = dropdownButton.contains(event.target);
            const isClickInsideMenu = dropdownMenu.contains(event.target);
            
            if (!isClickInsideButton && !isClickInsideMenu && !dropdownMenu.classList.contains('hidden')) {
                toggleMenu(false);
            }
        });
        
        const initializeApp = () => {
            // Re-select nav links in case the DOM wasn't fully ready before
            navLinks = dropdownMenu.querySelectorAll('.nav-link');
            
            // Add click listeners to all internal nav links to ensure smooth routing and close menu
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // Setting location.hash is the cleanest way for this SPA structure
                    const targetHash = link.getAttribute('href').substring(1);
                    window.location.hash = targetHash;
                    // renderPage() is called by hashchange, which handles closing the menu
                });
            });

            // Directly render the initial page content (Home or whatever is in the hash)
            renderPage();
        };

        // Initial page load: Run the initialization function when the DOM is ready
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

</body>
</html>



